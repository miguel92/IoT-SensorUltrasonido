{% extends "base.html" %}
{% block content %}

<div class="row">
    <div class="col-lg-12 text-center">
        <h1>Bienvenido a App IoT</h1>
    </div>
</div>
<br/>
<div class="card">
  <p class="card__name">Sensor de proximidad</p>
  <div id="contenido" class="jumbotron text-center mt-5">
    <embed src="https://media.geeksforgeeks.org/wp-content/uploads/20190531135120/beep.mp3" autostart="true" 
    width="0" height="0" id="sound1" enablejavascript="true">
    <button id="button" onclick="play()" hidden="true"></button>
  </div>

  
</div>


</div>
<br/>
<br/>

<script>
  function play() {
      var audio = new Audio(
'https://media.geeksforgeeks.org/wp-content/uploads/20190531135120/beep.mp3');
      audio.play();
  }
</script>


{% endblock content %}
{% block javascript%}
function play() {
  var audio = new Audio(
'https://media.geeksforgeeks.org/wp-content/uploads/20190531135120/beep.mp3');
  audio.play();
}
(function lecturasDatos() {
  $.ajax({
    url: '/lectura_datos',
    success: function(data) {
        console.log(data)
        var obj = JSON.parse(data)
        console.log(obj)
        if(obj.estado){
            //obj.datos[0]='0';
            var fecha = new Date(obj.datos[2].$date);
            var html = '<h4>Distancia: '+obj.datos[0]+'</h4>';
            html += '<h4>Tiempo: '+obj.datos[1]+'</h4>';
            html +='<p>Última actualización: '+ formatDate(fecha) +'</p> ';
            html += '<br>'
            html += '<br>'
            if (parseInt(obj.datos[0]) < 3){

              $('#button').trigger("click");   
              html += '<i class="fas fa-circle fa-10x" style="color: red;" id="icono_alerta"></i>'
              html += '<br>'
              html += '<br>'
              html += '<h4>¡Cuidado, coche cerca!</h4>'
            }else{
              html += '<i class="fas fa-circle fa-10x" style="color: green;" id="icono_alerta"></i>'
              html += '<br>'
              html += '<br>'
              html += '<h4>No hay peligro</h4>'
            }
            $('#contenido').html(html);
        }else{
            $('#contenido').html("Error");
        }
    },
    complete: function() {

      setTimeout(lecturasDatos, 1000);
    }
  });
})();

function formatDate(date){
    let day = date.getDate();
    let month = date.getMonth() + 1;
    let year = date.getFullYear();
    let hour = date.getHours();
    let minutes = date.getMinutes();
    let seconds = date.getSeconds();

    let cadena = ''

    if(day < 10){
      cadena += `0${day}`
    }else{
      cadena += `${day}`
    }
    if(month < 10){
      cadena += `-0${month}-${year} `
    }else{
      cadena += `-${month}-${year} `
    }

    if(hour < 10){
        cadena += `0${hour}:`
    }else{
        cadena += `${hour}:`
    }

    if(minutes < 10){
        cadena += `0${minutes}:`
    }else{
        cadena += `${minutes}:`
    }

    if(seconds < 10){
        cadena += `0${seconds}`
    }else{
        cadena += `${seconds}`
    }

    return cadena
};

{% endblock javascript%}